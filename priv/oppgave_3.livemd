# Temperaturm친ler

## Introduction
It's getting hot in here! 

I denne oppgaven skal vi leke oss med en temperaturm친ler. Vi skal bruke en sensor som m친ler n친v칝rende temperatur og printer ut data til en visuell graf. Modulen vi skal benytte oss av heter BME280 og har ingen relasjon til masse칮deleggende killer robots fra Terminator 游뱄 Modulen kobles til den samme knappmodulen som ble brukt i forrige oppgave (pHat) gjennom modulens innebygde Qwiic Connect System. Ja, det er s친nn "Qwiic" staves, jeg lover at jeg ikke er analfabet. For 친 komme igang, m친 vi f칮rst bruke en ledning fra posen v친r og koble den fra pHat'en til temperatursensoren via portene markert "qwiic". Deretter m친 vi... nei, det var egentlig alt.

## Setup
Temperaturgrafen v친r trenger noen biblioteker for 친 se fresh ut. Disse installeres gjennom [Mix](https://hexdocs.pm/mix/1.14/Mix.html). Det f칮rste biblioteket vi trenger er [`Vega-Lite`](https://github.com/vega/vega-lite), som er et bibliotek for 친 generere visualiseringer og grafer ved hjelp av data. Du kan legge passer'n tilbake i pennalet, med andre ord! [`Kino`](https://github.com/livebook-dev/kino) brukes av Livebook for 친 kunne rendre grafene pent i sanntid. Installer bibliotekene med kodesnutten under.

```elixir
Mix.install([
  :bmp280,
  {:kino, "~> 0.7.0"},
  {:vega_lite, "~> 0.1.6"}
])
```

Wow! I Elixir kan man ogs친 sette opp aliaser:

```elixir
alias VegaLite, as: Vl
```

## Sanity check og initialisering
N친 som bibliotekene er installerte, b칮r du sjekke at sensoren dukker opp og er tilgjengelig for Livebook.

```elixir
Circuits.I2C.detect_devices()
```

Sensoren vil mest sannsynlig vises under adresse `0x77`, men den kan ogs친 ende opp p친 `0x76`. Om det er tilfellet, er du n칮dt til 친 endre verdien til `bus_address` i kodesnutten under.

```elixir
{:ok, bmp} = BMP280.start_link(bus_name: "i2c-1", bus_address: 0x77)
```

Ser alt bra ut? Heftig! Da kan vi begynne 친 m친le temperatur. Helst ikke bruk sensoren til 친 sjekke om du har feber. Jeg kan ikke garantere dens renslighet.

## Les data og generer en graf
칀 lese data fra sensoren gj칮res enkelt med kommandoen under.

```elixir
BMP280.measure(bmp)
```

For 친 generere en graf basert p친 sanntidsdata, trengs derimot litt mer kode. Under ser du syntaksen for 친 generere en graf-widget 游늳 Den bruker Vega-Lite for 친 sette opp widgeten med `Vl.new(...)`, og deretter Kino for 친 periodisk oppdatere widgeten med ny data.

```elixir
widget =
  Vl.new(width: 700, height: 400, title: "BME280 Temperature & Dew Point")
  |> Vl.mark(:line)
  |> Vl.encode_field(:x, "x", title: "Sample #", type: :quantitative)
  |> Vl.encode_field(:y, "y", title: "Celsius", type: :quantitative)
  |> Vl.encode_field(:color, "key", type: :nominal, title: nil)
  |> Kino.VegaLite.new()
  |> tap(&Kino.render/1)

Kino.VegaLite.periodically(widget, 100, 0, fn i ->
  {:ok, measurement} = BMP280.measure(bmp)

  points = [
    %{key: "Temperature", x: i, y: measurement.temperature_c},
    %{key: "Dew Point", x: i, y: measurement.dew_point_c}
  ]

  Kino.VegaLite.push_many(widget, points, window: 100)
  {:cont, i + 1}
end)
```

Kult! Pr칮v 친 varme opp sensoren med h친nden din, pusten din, en klem, eller ved 친 gi den en god skuldermassasje etter en lang arbeidsdag. Om alt fungerer som det skal, b칮r du se temperaturen stige i sanntid. Om du er usikker p친 hva "Dew Point" betyr, har Bekk investert i internett til deg s친 du kan Google ting av en grunn.

Da har vi g친tt gjennom det groveste. P친 tide 친 ha det litt g칮y!

## 洧돂洧돃洧뉧롓륋롓
BME280 m친ler ganske s친 mye. Pr칮v 친 finne ut hva mer du kan m친le og hvordan du kan visualisere det! Alle measurements finner du ved 친 kj칮re kodesnutten:

```elixir
BMP280.measure(bmp)
```

### Mekk noen nye grafer
Se om du klarer 친 lage noen andre grafer! Sjekk [dokumentasjonen](https://vega.github.io/vega-lite/docs/) til Vega-Lite og [listen over eksempler](https://vega.github.io/vega-lite/examples/). Kanskje du blir inspirert? Hvis ikke kan du pr칮ve deg p친 oppgaven under 游뱁

```elixir
# Din heite graf her
```

### Tilbake til LED-tiden
Husker du oppgave 1? Selvsagt gj칮r du det! I kodeblokken under skal du skrive kode for 친 f친 gode gamle `led_0` til 친 blinke tregere (eller raskere!) basert p친 sensorinput. Bruk hvilken measurement og LED-trigger du vil. Det er bare fantasien (og hardware (og tidsbegrensninger)) som setter grenser!


```elixir
# blink... blink... blink blink blinkblinkblink
```
## Grafer p친 skjermen

For 친 styre skjermen s친 har vi biblioteket [oled](https://github.com/pappersverk/oled). Dette lar oss tegne primitive figurer p친 skjermen som enkelt piksel, trekanter, linjer, osv. Vi har lastet inn biblioteket fra f칮r av og det er tilgjengelig under `NervesLivebook.OLED`.

For 친 f친 til 친 vise komplekse ting some tekst(!) s친 kan vi kombinere `oled` bilbioteket med [Chisel](https://hexdocs.pm/chisel/readme.html) som blant annet kan oversette tekststreng gitt en font til punkter i to dimensjoner.

```elixir
# En funksjon som tar imot kooardinat x og y og oversette det til en piksel p친 skjermen
put_pixel = fn x, y do
  NervesLivebook.OLED.put_pixel(x, y)
end

# Vi har en fontfil liggende fra f칮r av som vi kan gjenbruke
{:ok, font} = Chisel.Font.load("/fonts/cure.bdf")

# S칮rg for at skjermen start med ett blankt utgangspunkt
NervesLivebook.OLED.clear()

# Bruk Chisel til 친 oversette teksten til pikselpunkter
Chisel.Renderer.draw_text("Hei verden!", 10, 10, font, put_pixel, size_x: 2, size_y: 2)

# Dytt bilet v친rt ut
NervesLivebook.OLED.display()
```

Forh친pentligvis s친 har du f친tt en liten hilsen n친. Som man ser s친 vet `Chisel` ingenting om hvordan skjermen fungerer og forholder seg kun til at den f친r en funksjon som i dette tilfellet tar seg av oversetting til `oled` bilbioteket. Videre er vi selv ansvarlig for 친 blanke eksisterende innehold p친 skjermen og fortelle n친r den skal tegne ut endringene til skjermen. Ta gjerne en titt p친 hva som skjer om du kommenterer ut disse kallene enkeltvis i koden ovenfor.

### Skrve verdier

TODO Vi kan starte med 친 skrive ut verdiene fra sensoren

### Grafe verdiene

TODO For 친 lage en graf s친 trenger vi kun 친 forholde oss til de primitive operasjonene som `oled` bibliteket gir oss. Ta en titt p친 GitHub siden og se om du f친r tenget ut en strek eller to. Deretter kan vi begynne 친 kombinere fast utlesning av temperaturen og kontinuerlig oppdatering av grafen ut mot skjermen.
